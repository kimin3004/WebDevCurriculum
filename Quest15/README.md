# Quest 15. 자동화된 테스트

## Introduction

- 이번 퀘스트에서는 자동화된 테스트에 어떤 장점이 있는지, 어떤 식으로 구축할 수 있는지에 대해 알아보겠습니다.

## Topics

- Automated Test
  - TDD
  - Unit Test
  - Integration Test
  - E2E Test
  - Stub & Mock
- Jest
- Puppeteer

## Resources

- [Unit Test (단위 테스트) 도입하기](https://www.popit.kr/unit-test-%EB%8B%A8%EC%9C%84-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EB%8F%84%EC%9E%85%ED%95%98%EA%B8%B0-1%ED%8E%B8/)
- [소프트웨어 테스트 안티 패턴](https://velog.io/@leejh3224/%EC%86%8C%ED%94%84%ED%8A%B8%EC%9B%A8%EC%96%B4-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%95%88%ED%8B%B0-%ED%8C%A8%ED%84%B4)
- [End-to-End testing with Puppeteer and Jest](https://medium.com/touch4it/end-to-end-testing-with-puppeteer-and-jest-ec8198145321)
- [Mock & Stub](https://stackoverflow.com/questions/3459287/whats-the-difference-between-a-mock-stub)

## Checklist

- 자동화된 테스트를 만드는 것에는 어떤 장점과 단점이 있을까요?

  - TDD(Test-Driven Development)란 무엇인가요? TDD의 장점과 단점은 무엇일까요?

    - TDD란 Test Driven Development의 약자로 '테스트 주도 개발'은 매우 짧은 개발 사이클을 반복하는 소프트웨어 개발 프로세스 중 하나이다.

    - 개발자는 먼저 요구사항을 검증하는 자동화된 테스트 케이스를 작성한다. 그런 후에, 그 테스트 케이스를 통과하기 위한 최소한의 코드를 생성한다. 마지막으로 작성한 코드를 표준에 맞도록 리팩토링한다.

      ![http://clipsoft.co.kr/wp/wp-content/uploads/2021/05/ka1-748x585.png](http://clipsoft.co.kr/wp/wp-content/uploads/2021/05/ka1-748x585.png)

    - TDD와 일반적인 개발 방식의 가장 큰 차이점은 테스트 코드를 작성한 뒤에 실제 코드를 작성한다는 점이다.

    - 디자인(설계) 단계에서 프로그래밍 목적을 반드시 미리 정의해야만 하고, 또 무엇을 테스트해야 할지 미리 정의(테스트 케이스 작성)해야만 한다.

    - 테스트 코드를 작성하는 도중에 발생하는 예외 사항(버그, 수정사항)들은 테스트 케이스에 추가하고 설계를 개선한다. 이후 테스트가 통과된 코드만을 코드 개발 단계에서 실제 코드로 작성한다.

    > 장점

    1. 객체 지향적인 코드 개발

    - TDD는 코드의 재사용 보장을 명시하므로 TDD를 통한 소프트웨어 개발 시 기능별로 모듈화가 이루어진다. 이는 의존성과 종속성이 낮은 모듈로 조합된 소프트웨어 개발을 가능하게 하며, 필요에 따라 모듈을 추가하거나 제거해도 소프트웨어 전체 구조에 영향을 미치지 않게 된다.

    2. 설계 수정시간의 단축

    - 테스트코드를 먼저 작성하기 때문에 최초 설계안을 만족하게 하며 입출력 구조와 기능의 정의를 명확하게 하게 되므로 설계의 구조적 문제를 바로 찾아낼 수 있다.

    3. 유지보수(리팩토링)의 용이성

    - 기본적으로 단위 테스트 기반의 테스트 코드를 작성하기 때문에 추후 문제가 발생하였을 때 각각의 모듈별로 테스트를 진행해보면 문제의 지점을 쉽게 찾을 수 있다.

    4. 테스트 문서의 대체 가능

    - 대부분의 개발 프로젝트에서 테스트를 진행하는 경우 단순 통합 테스트에 지나지 않는다. TDD를 하게 될 때 테스팅을 자동화시킴과 동시에 더욱 정확한 테스트 근거를 산출해 정의서를 작성할 수 있다.

    > 단점

    1. 사전준비 기간

    - TDD를 프로젝트에 도입하려면 사전에 필요한 지식을 습득하고 개발 환경을 구축해야 한다. TDD를 효과적으로 사용할 수 있는 수준으로 개발자를 교육하는 데 보통 1~6개월간의 시간이 필요하다고 한다.

    2. 생산성 저하

    - 프로젝트를 진행할 때 경험 때문에 어떤 예외상황이 발생할지 눈에 뻔히 보이는 경우가 종종 있다. 이러한 단발성 개발은 개발 기간이 타이트하게 잡히는 경우가 많은데, 이럴 때 TDD를 이용해 테스트 코드를 작성하고 그에 통과하기 위한 코드를 작성한다면 비효율적일 것이다.

- 테스트들 간의 계층에 따라 어떤 단계들이 있을까요?

  - 유닛 테스트, 통합 테스트, E2E 테스트는 각각 어떤 것을 뜻하나요?

    1. 단위 테스트(Unit Test)

    - 단위 테스트는 응용 프로그램에서 테스트 가능한 가장 작은 소프트웨어를 실행하여 예상대로 동작하는지 확인하는 테스트이다.
    - 테스트 단위의 크기는 정해져있지 않으나, 일반적으로 클래스 또는 메소드 수준으로 정해진다.
    - 소프트웨어 내부 구조나 구현 방법을 고려하여 개발자 관점에서 테스트한다.

      <br/>

    2. 통합 테스트(Integration Test)

    - 통합 테스트는 단위 테스트보다 더 큰 동작을 달성하기 위해 여러 모듈들을 모아 이들이 의도대로 협력하는지 확인하는 테스트이다.
    - 단위 테스트와 달리 개발자가 변경할 수 없는 부분(ex. 외부 라이브러리)까지 묶어 검증할 때 사용한다. DB에 접근하거나 전체 코드와 다양한 환경이 제대로 작동하는지 확인하는데 필요한 모든 작업을 수행할 수 있다.
    - 장점 : 단위 테스트에서 발견하기 어려운 버그를 찾을 수 있다. (ex. 환경 버그 - 싱글 코어 CPU에서는 잘 실행되나 쿼드 코어 CPU에서는 잘 실행되지 않음 - 등이 발생)
    - 단점 : 단위 테스트보다 더 많은 코드를 테스트하기 때문에 신뢰성이 떨어질 수 있다.

    <br/>

    3. E2E 테스트(End To End Test)

    - Endpoint(종단) 간 테스트로 사용자의 입장에서 사용자가 사용하는 상황을 가정하는 테스트이다.
    - 웹이나 어플 등에서 사용자에게 직접적으로 노출되는 GUI를 통해 시나리오, 기능 테스트 등을 수행한다.
    - Endpoint 테스트를 통과하면 기능 자체는 잘 작동한다는 것이므로 모든 테스트를 할 수 없다면 E2E Test만이라도 하는 것이 권장된다.

    <br/>

- 테스트에 있어서 Stub과 Mock은 어떤 개념을 가리키는 것일까요?

  1. Stub

  - 인스턴스화하여 구현한 가짜 객체(=Dummy. 기능 구현 X)를 이용해 실제로 동작하는 것처럼 "보이게" 만드는 객체이다.
  - 해당 인터페이스 or 클래스를 최소한으로 구현한다.
  - 테스트에서 호출된 요청에 대해 미리 준비해둔 결과를 전달한다.

  2. Mock

  - 호출에 대한 기대를 명세하고, 내용에 따라 동작하도록 프로그래밍 된 객체이다.
  - 테스트 작성을 위한 환경 구축이 어려울 때, 테스트하고자 하는 코드와 엮인 객체들을 대신하기 위해 만들어진 객체이다.

  > Mocks vs Stubs = Behavioral testing vs State testing

  - 상태 검증 : 메소드가 수행된 후, 객체의 상태를 확인하여 올바르게 동작했는지를 확인하는 검증법입니다

  - 행위 검증 : 메소드의 리턴 값으로 판단할 수 없는 경우 특정 동작을 수행하는지확인하는 검증법입니다

- Jest는 어떤 일을 하며 어떻게 사용하는 테스트 프레임워크일까요?

  - JS 테스트를 위한 All-in-one 테스팅 라이브러리이다. Jest 이전에는 자바스크립트 코드를 테스트하라면 여러가지 테스팅 라이브러리를 조합해서 사용하곤 했었다. 하지만 Jest는 라이브러리 하나만 설치하면, Test Runner와 Test Mathcher 그리고 Test Mock 프레임워크까지 제공한다.

  - Jest 이외의 테스트 프레임워크는 어떤 것이 있고 어떤 장단점이 있을까요?

- Puppeteer는 어떤 일을 하며 어떻게 사용하는 테스트 프레임워크일까요?

## Quest

- 직전 퀘스트의 메모장의 서버와 클라이언트 각 부분에 유닛 테스트, 통합 테스트, E2E 테스트 등을 추가해 보세요.
  - `npm test` 명령을 통해 모든 테스트가 돌고 그 결과를 출력할 수 있어야 합니다.

## Advanced

- 테스트의 커버리지는 어떤 개념일까요? 프로젝트에서 테스트의 커버리지는 어떻게 접근하는 것이 좋을까요?
